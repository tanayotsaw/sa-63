'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

require('commander');
require('chalk');
var index = require('./index-8e863345.js');
var fs = _interopDefault(require('fs-extra'));
require('@backstage/cli-common');
require('path');
require('child_process');
require('util');
var run = require('./run-76e92ad7.js');
require('tar');
require('os');
var index$1 = require('./index-62988e0e.js');

const PKG_PATH = "package.json";
var buildImage = async (imageTag) => {
  const pkgPath = index.paths.resolveTarget(PKG_PATH);
  const pkg = await fs.readJson(pkgPath);
  const tempDistWorkspace = await index$1.createDistWorkspace([pkg.name], {
    files: [
      "package.json",
      "yarn.lock",
      "app-config.yaml",
      {src: index.paths.resolveTarget("Dockerfile"), dest: "Dockerfile"}
    ]
  });
  console.log(`Dist workspace ready at ${tempDistWorkspace}`);
  await run.run("docker", ["build", ".", "-t", imageTag], {
    cwd: tempDistWorkspace
  });
  await fs.remove(tempDistWorkspace);
};

exports.default = buildImage;
